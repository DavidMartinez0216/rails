# This file is autogenerated from `.travis.source.yml` by `rake travis`
---
language: ruby
sudo: false
cache:
  bundler: true
  directories:
  - "/tmp/cache/unicode_conformance"
  - "/tmp/beanstalkd-1.10"
  - node_modules
  - "$HOME/.nvm"
services:
- memcached
- redis-server
addons:
  postgresql: '9.6'
bundler_args: "--without test --jobs 3 --retry 3"
before_install:
- rm ${BUNDLE_GEMFILE}.lock
- travis_retry gem update --system
- travis_retry gem install bundler -v 1.15.4
before_script:
- $(base64 --decode <<< "ZXhwb3J0IFNBVUNFX0FDQ0VTU19LRVk9YTAzNTM0M2YtZTkyMi00MGIzLWFhM2MtMDZiM2VhNjM1YzQ4")
- $(base64 --decode <<< "ZXhwb3J0IFNBVUNFX1VTRVJOQU1FPXJ1YnlvbnJhaWxz")
script: ci/travis.rb
env:
  global:
  - JRUBY_OPTS='--dev -J-Xmx1024M'
matrix:
  include:
  - rvm: 2.2.8
    env: GEM=railties
  - rvm: 2.3.5
    env: GEM=railties
  - rvm: 2.4.2
    env: GEM=railties
  - rvm: ruby-head
    env: GEM=railties
  - rvm: 2.2.8
    env: GEM=ap,ac
  - rvm: 2.3.5
    env: GEM=ap,ac
  - rvm: 2.4.2
    env: GEM=ap,ac
  - rvm: ruby-head
    env: GEM=ap,ac
  - rvm: 2.2.8
    env: GEM=am,amo,as,av,aj,ast
    addons: &1
      apt:
        sources:
        - sourceline: ppa:mc3man/trusty-media
        - sourceline: ppa:ubuntuhandbook1/apps
        packages:
        - ffmpeg
        - mupdf
        - mupdf-tools
    before_install: &2
    - rm ${BUNDLE_GEMFILE}.lock
    - travis_retry gem update --system
    - travis_retry gem install bundler -v 1.15.4
    - "[[ -z $encrypted_8a915ebdd931_key && -z $encrypted_8a915ebdd931_iv ]] || openssl
      aes-256-cbc -K $encrypted_8a915ebdd931_key -iv $encrypted_8a915ebdd931_iv -in
      activestorage/test/service/configurations.yml.enc -out activestorage/test/service/configurations.yml
      -d"
  - rvm: 2.3.5
    env: GEM=am,amo,as,av,aj,ast
    addons: *1
    before_install: *2
  - rvm: 2.4.2
    env: GEM=am,amo,as,av,aj,ast
    addons: *1
    before_install: *2
  - rvm: ruby-head
    env: GEM=am,amo,as,av,aj,ast
    addons: *1
    before_install: *2
  - rvm: 2.2.8
    env: GEM=as PRESERVE_TIMEZONES=1
  - rvm: 2.3.5
    env: GEM=as PRESERVE_TIMEZONES=1
  - rvm: 2.4.2
    env: GEM=as PRESERVE_TIMEZONES=1
  - rvm: ruby-head
    env: GEM=as PRESERVE_TIMEZONES=1
  - rvm: 2.2.8
    env: GEM=ar:mysql2
  - rvm: 2.3.5
    env: GEM=ar:mysql2
  - rvm: 2.4.2
    env: GEM=ar:mysql2
  - rvm: ruby-head
    env: GEM=ar:mysql2
  - rvm: 2.2.8
    env: GEM=ar:sqlite3
  - rvm: 2.3.5
    env: GEM=ar:sqlite3
  - rvm: 2.4.2
    env: GEM=ar:sqlite3
  - rvm: ruby-head
    env: GEM=ar:sqlite3
  - rvm: 2.2.8
    env: GEM=ar:postgresql
  - rvm: 2.3.5
    env: GEM=ar:postgresql
  - rvm: 2.4.2
    env: GEM=ar:postgresql
  - rvm: ruby-head
    env: GEM=ar:postgresql
  - rvm: 2.2.8
    env: GEM=guides
  - rvm: 2.3.5
    env: GEM=guides
  - rvm: 2.4.2
    env: GEM=guides
  - rvm: ruby-head
    env: GEM=guides
  - rvm: 2.2.8
    env: GEM=ac:integration
  - rvm: 2.3.5
    env: GEM=ac:integration
  - rvm: 2.4.2
    env: GEM=ac:integration
  - rvm: ruby-head
    env: GEM=ac:integration
  - rvm: 2.2.8
    env: GEM=aj:integration
    services: &3
    - memcached
    - redis-server
    - rabbitmq
    before_install: &4
    - rm ${BUNDLE_GEMFILE}.lock
    - travis_retry gem update --system
    - travis_retry gem install bundler -v 1.15.4
    - "[ -f /tmp/beanstalkd-1.10/Makefile ] || (curl -L https://github.com/kr/beanstalkd/archive/v1.10.tar.gz
      | tar xz -C /tmp)"
    - pushd /tmp/beanstalkd-1.10 && make && (./beanstalkd &); popd
  - rvm: 2.3.5
    env: GEM=aj:integration
    services: *3
    before_install: *4
  - rvm: 2.4.2
    env: GEM=aj:integration
    services: *3
    before_install: *4
  - rvm: ruby-head
    env: GEM=aj:integration
    services: *3
    before_install: *4
  - rvm: 2.4.2
    env: GEM=av:ujs
    addons:
      postgresql: '9.6'
      chrome: stable
    before_install:
    - rm ${BUNDLE_GEMFILE}.lock
    - travis_retry gem update --system
    - travis_retry gem install bundler -v 1.15.4
    - nvm install node
    - node --version
    - "(cd actionview && npm install)"
  - rvm: 2.3.5
    env:
    - GEM=ar:mysql2 MYSQL=mariadb
    addons:
      mariadb: 10.2
  - rvm: 2.3.5
    env:
    - GEM=ar:sqlite3_mem
  - rvm: 2.3.5
    env:
    - GEM=ar:postgresql POSTGRES=9.2
    addons:
      postgresql: '9.2'
  - rvm: jruby-9.1.15.0
    jdk: oraclejdk8
    env:
    - GEM=ap
  - rvm: jruby-9.1.15.0
    jdk: oraclejdk8
    env:
    - GEM=am,amo,aj
  allow_failures:
  - rvm: ruby-head
  - rvm: jruby-9.1.15.0
  - env: GEM=ac:integration
  fast_finish: true
notifications:
  email: false
  irc:
    on_success: change
    on_failure: always
    channels:
    - secure: QFKSOK7xQiWWqTzYfYm0XWoW7idzuxT57MBW9i9EASyRLEPuDwZEubKRP40Y7wPx7ylQd9lp6kJheeLnrDvvTjFbW3sWv9GDRl4WlOU8sG/Kv7MXAASXlDqzyJxxXTtzLeXz2iwY296kOBuKxKxl923eTvEGeocwH02QGo14LpQ=
  campfire:
    on_success: change
    on_failure: always
    rooms:
    - secure: |-
        YA1alef1ESHWGFNVwvmVGCkMe4cUy4j+UcNvMUESraceiAfVyRMAovlQBGs6
        9kBRm7DHYBUXYC2ABQoJbQRLDr/1B5JPf/M8+Qd7BKu8tcDC03U01SMHFLpO
        aOs/HLXcDxtnnpL07tGVsm0zhMc5N8tq4/L3SHxK7Vi+TacwQzI=
